<!-- profile.component.html - COM BOLINHAS FLUTUANTES -->

<!-- âœ¨ Bolinhas flutuantes no background -->
<div class="floating-elements">
  <div class="floating-circle circle-1"></div>
  <div class="floating-circle circle-2"></div>
  <div class="floating-circle circle-3"></div>
  <div class="floating-circle circle-4"></div>
</div>

<div class="profile-container" *ngIf="!isLoading && stats">
  <div class="profile-header">
    <img [src]="stats.avatarUrl" [alt]="'profile.header.avatarAlt' | translate" class="profile-avatar">
    <div class="profile-info">
      <h1>{{ stats.steamUsername }}</h1>
      <p>{{ 'profile.header.memberSince' | translate }} {{ stats.created_at | date:'longDate' }}</p>
      <span class="status-badge" [class.premium]="stats.accountStatus === 'Premium'">{{ getAccountStatusTranslated(stats.accountStatus) }}</span>
    </div>
  </div>

  <div class="stats-grid general-stats">
    <div class="stat-card">
      <h3>{{ 'profile.stats.evaluationsMade' | translate }}</h3>
      <p class="stat-value">{{ stats.totalEvaluations }}</p>
    </div>
    <div class="stat-card">
      <h3>{{ 'profile.stats.averageRating' | translate }}</h3>
      <p class="stat-value">{{ stats.averageRating | number:'1.1-1' }}/5</p>
    </div>
    <div class="stat-card">
      <h3>{{ 'profile.stats.selfEvaluation' | translate }}</h3>
      <p class="stat-value" *ngIf="stats.selfAverageRating > 0; else noSelfRating">{{ stats.selfAverageRating | number:'1.1-1' }}/5</p>
      <ng-template #noSelfRating><p class="stat-value">{{ 'profile.data.noData' | translate }}</p></ng-template>
    </div>

    <ng-container *ngIf="stats.accountStatus === 'Premium'">
      <div class="stat-card premium-feature">
        <h3>{{ 'profile.premium.evaluationsReceived' | translate }}</h3>
        <p class="stat-value">{{ stats.receivedEvaluationsCount }}</p>
        <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
      </div>
      <div class="stat-card premium-feature">
        <h3>{{ 'profile.premium.averageReceivedRating' | translate }}</h3>
        <p class="stat-value" *ngIf="stats.averageReceivedRating > 0; else noReceivedRating">{{ stats.averageReceivedRating | number:'1.1-1' }}/5</p>
        <ng-template #noReceivedRating><p class="stat-value">{{ 'profile.data.noData' | translate }}</p></ng-template>
        <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
      </div>
      <div class="stat-card premium-feature">
        <h3>{{ 'profile.premium.tiltWinRate' | translate }}</h3>
        <p class="stat-value" *ngIf="stats.tiltAnalysis?.tiltWinRate !== null; else noTiltData">{{ stats.tiltAnalysis?.tiltWinRate }}%</p>
        <ng-template #noTiltData><p class="stat-value">{{ 'profile.data.noData' | translate }}</p></ng-template>
        <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
      </div>
    </ng-container>

    <ng-container *ngIf="stats.accountStatus !== 'Premium'">
      <div class="stat-card premium-feature">
          <h3>{{ 'profile.premium.evaluationsReceived' | translate }}</h3>
          <div class="upgrade-prompt">
            <button class="upgrade-button" (click)="goToPremium()">{{ 'profile.upgrade.button' | translate }}</button>
          </div>
          <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
      </div>
      <div class="stat-card premium-feature">
        <h3>{{ 'profile.premium.averageReceivedRating' | translate }}</h3>
        <div class="upgrade-prompt">
            <button class="upgrade-button" (click)="goToPremium()">{{ 'profile.upgrade.button' | translate }}</button>
          </div>
          <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
        </div>
      <div class="stat-card premium-feature">
        <h3>{{ 'profile.upgrade.tiltWinRateTitle' | translate }}</h3>
        <div class="upgrade-prompt">
            <button class="upgrade-button" (click)="goToPremium()">{{ 'profile.upgrade.button' | translate }}</button>
          </div>
          <span class="premium-badge">{{ 'profile.premium.badge' | translate }}</span>
        </div>
    </ng-container>
  </div>

  <div class="section-divider">
    <h2>{{ 'profile.matches.mostUsedTags' | translate }}</h2>
  </div>

  <div class="stats-grid">
    <div class="stat-card full-width">
      <h3>{{ 'profile.matches.mostUsedTags' | translate }}</h3>
      <div class="tags-container" *ngIf="stats.mostUsedTags && stats.mostUsedTags.length > 0; else noTags">
        <span class="tag-badge" *ngFor="let tag of stats.mostUsedTags">{{ tag }}</span>
      </div>
      <ng-template #noTags>
        <p class="stat-value">{{ 'profile.data.noData' | translate }}</p>
      </ng-template>
    </div>
  </div>

  <div class="section-divider">
    <h2>{{ 'profile.matches.last20Matches' | translate }}</h2>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <h3>{{ 'profile.matches.playersEvaluated' | translate }}(%)</h3>
      <p class="stat-value">{{ stats.evaluationPercentage }}%</p>
    </div>

    <div class="stat-card">
      <h3>{{ 'profile.matches.wins' | translate }}</h3>
      <p class="stat-value">{{ stats.winsLast20 }}/20</p>
      <ng-template #noWinData><p class="stat-value">{{ 'profile.data.noData' | translate }}</p></ng-template>
    </div>

    <div class="stat-card">
      <h3>{{ 'profile.matches.averageMatchTime' | translate }}</h3>
      <p class="stat-value" *ngIf="stats.averageMatchTime; else noTimeData">{{ stats.averageMatchTime | secondsToTime }}</p>
      <ng-template #noTimeData><p class="stat-value">{{ 'profile.data.noData' | translate }}</p></ng-template>
    </div>

    <div class="stat-card">
    <h3>{{ 'profile.matches.averageKda' | translate }}</h3>
      <div *ngIf="stats.averageKda; else noKda" class="kda-display">
        <span>{{ stats.averageKda.kills }}</span>
        <span class="divider">/</span>
        <span>{{ stats.averageKda.deaths }}</span>
        <span class="divider">/</span>
        <span>{{ stats.averageKda.assists }}</span>
      </div>
      <ng-template #noKda>
        <p class="stat-value">{{ 'profile.data.noData' | translate }}</p>
      </ng-template>
    </div>

    <div class="stat-card">
      <h3>{{ 'profile.matches.mostPlayedHero' | translate }}</h3>
      <div *ngIf="stats.mostUsedHeroId" class="hero-stat">
        <img [src]="gameDataService.getHeroImageUrl(stats.mostUsedHeroId)" class="hero-icon">
        <span>{{ gameDataService.getHeroById(stats.mostUsedHeroId)?.localized_name }}</span>
      </div>
      <p *ngIf="!stats.mostUsedHeroId" class="stat-value">{{ 'profile.data.noData' | translate }}</p>
    </div>

    <div class="stat-card">
      <h3>{{ 'profile.matches.mostFacedHero' | translate }}</h3>
      <div *ngIf="stats.mostFacedHeroId" class="hero-stat">
        <img [src]="gameDataService.getHeroImageUrl(stats.mostFacedHeroId)" class="hero-icon">
        <span>{{ gameDataService.getHeroById(stats.mostFacedHeroId)?.localized_name }}</span>
      </div>
      <p *ngIf="!stats.mostFacedHeroId" class="stat-value">{{ 'profile.data.noData' | translate }}</p>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="loading-message">
  <p>{{ 'profile.loading.text' | translate }}</p>
</div>

<div *ngIf="!isLoading && !stats" class="loading-message">
    <p>{{ 'profile.error.loadStats' | translate }}</p>
</div>

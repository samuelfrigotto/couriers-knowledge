<div class="matches-container">
  <div *ngIf="selectedMatch; else matchList" class="details-view">
    <!-- Header modernizado -->
    <div class="details-header">
      <button class="back-button" (click)="backToMatches()">
        ‚Üê Voltar para Partidas
      </button>
      <div class="details-title">
        <h2>
          {{ selectedMatch.radiant_win ? 'Vit√≥ria do Time Iluminado' : 'Vit√≥ria do Time Temido' }}
        </h2>
        <span class="match-duration">{{ (selectedMatch.duration / 60) | number:'1.0-0' }} min</span>
      </div>
      <div class="details-score">
        <span class="radiant-score">{{ selectedMatch.radiant_score }}</span>
        <span class="vs-text"> vs </span>
        <span class="dire-score">{{ selectedMatch.dire_score }}</span>
      </div>
    </div>

    <div *ngIf="isDetailsLoading" class="loading-message">Carregando detalhes...</div>

    <div *ngIf="!isDetailsLoading" class="teams-container">
      <!-- Time Iluminado (Radiant) -->
      <div class="team-column">
        <div class="team-header">
          <h3 class="team-title">Time Iluminado</h3>
        </div>

        <div *ngFor="let player of selectedMatch.players | filter:true:'is_radiant'" class="player-detail-card">
          <img [src]="gameDataService.getHeroImageUrl(player.hero_id)"
               class="hero-portrait-detail"
               [alt]="gameDataService.getHeroById(player.hero_id)?.localized_name">

          <div class="player-info-detail">
            <span class="player-name-detail">{{ player.personaname || 'An√¥nimo' }}</span>
            <div class="kda">
              <span>{{ player.kills }}</span> /
              <span>{{ player.deaths }}</span> /
              <span>{{ player.assists }}</span>
            </div>
            <div class="player-gold">
              <span class="gold-value">{{ player.net_worth | number }}</span>
              <span class="gold-label">Gold</span>
            </div>
          </div>

          <!-- Container dos itens -->
          <div class="items-container">
            <!-- Invent√°rio principal (6 itens em linha) -->
            <div class="items-grid">
              <img *ngFor="let itemId of player.items"
                   [src]="gameDataService.getItemImageUrl(itemId)"
                   class="item-icon"
                   [class.empty-slot]="itemId === 0"
                   [alt]="gameDataService.getItemById(itemId)?.localized_name">
            </div>

            <!-- Mochila (3 itens em preto e branco) -->
            <div class="backpack-grid">
              <img *ngFor="let itemId of player.backpack"
                   [src]="gameDataService.getItemImageUrl(itemId)"
                   class="item-icon"
                   [class.empty-slot]="itemId === 0"
                   [alt]="gameDataService.getItemById(itemId)?.localized_name">
            </div>
          </div>

          <button class="evaluate-button"
                  [disabled]="player.is_already_evaluated || !player.steam_id_64"
                  (click)="evaluatePlayer(player)">
            {{ player.is_already_evaluated ? 'Avaliado' : 'Avaliar' }}
          </button>
        </div>
      </div>

      <!-- Time Temido (Dire) -->
      <div class="team-column">
        <div class="team-header">
          <h3 class="team-title">Time Temido</h3>
        </div>

        <div *ngFor="let player of selectedMatch.players | filter:false:'is_radiant'" class="player-detail-card">
          <img [src]="gameDataService.getHeroImageUrl(player.hero_id)"
               class="hero-portrait-detail"
               [alt]="gameDataService.getHeroById(player.hero_id)?.localized_name">

          <div class="player-info-detail">
            <span class="player-name-detail">{{ player.personaname || 'An√¥nimo' }}</span>
            <div class="kda">
              <span>{{ player.kills }}</span> /
              <span>{{ player.deaths }}</span> /
              <span>{{ player.assists }}</span>
            </div>
            <div class="player-gold">
              <span class="gold-value">{{ player.net_worth | number }}</span>
              <span class="gold-label">Gold</span>
            </div>
          </div>

          <!-- Container dos itens -->
          <div class="items-container">
            <!-- Invent√°rio principal (6 itens em linha) -->
            <div class="items-grid">
              <img *ngFor="let itemId of player.items"
                   [src]="gameDataService.getItemImageUrl(itemId)"
                   class="item-icon"
                   [class.empty-slot]="itemId === 0"
                   [alt]="gameDataService.getItemById(itemId)?.localized_name">
            </div>

            <!-- Mochila (3 itens em preto e branco) -->
            <div class="backpack-grid">
              <img *ngFor="let itemId of player.backpack"
                   [src]="gameDataService.getItemImageUrl(itemId)"
                   class="item-icon"
                   [class.empty-slot]="itemId === 0"
                   [alt]="gameDataService.getItemById(itemId)?.localized_name">
            </div>
          </div>

          <button class="evaluate-button"
                  [disabled]="player.is_already_evaluated || !player.steam_id_64"
                  (click)="evaluatePlayer(player)">
            {{ player.is_already_evaluated ? 'Avaliado' : 'Avaliar' }}
          </button>
        </div>
      </div>
    </div>

    <div class="advanced-analysis-card" (click)="openStratzAnalysis(selectedMatch.match_id)">
      <div class="analysis-content">
        <div class="analysis-icon">
          üìä
        </div>
        <div class="analysis-text">
          <h4>An√°lise Avan√ßada da Partida</h4>
          <p>Clique aqui para ver estat√≠sticas detalhadas, gr√°ficos de economia, timeline e muito mais no Stratz</p>
        </div>
        <div class="analysis-arrow">
          ‚Üí
        </div>
      </div>
      <div class="analysis-footer">
        <span class="powered-by">Powered by Stratz</span>
        <span class="match-id">Match ID: {{ selectedMatch.match_id }}</span>
      </div>
    </div>


  </div>

  <!-- Lista de partidas (mantida igual) -->
  <ng-template #matchList>
    <h1>Partidas Recentes</h1>
    <!-- Estado de carregamento -->
  <div *ngIf="isLoading$ | async">
    <app-empty-state
      [config]="{
        type: 'matches',
        title: 'Carregando suas partidas...',
        subtitle: 'Buscando seu hist√≥rico de partidas recentes',
        showAction: false
      }">
    </app-empty-state>
  </div>

  <!-- Estado vazio quando n√£o h√° partidas -->
  <div *ngIf="(matches$ | async)?.length === 0 && !(isLoading$ | async)">
    <app-empty-state
      [config]="{
        type: 'matches',
        title: 'Nenhuma partida encontrada',
        subtitle: 'Suas partidas aparecer√£o aqui quando voc√™ come√ßar a jogar',
        actionText: 'Configurar GSI',
        showAction: false
      }"
      (emptyStateAction)="onEmptyStateAction($event)">
    </app-empty-state>
  </div>

    <div class="match-list-container" *ngIf="matches$ | async as matches">
      <div *ngIf="matches.length > 0" class="match-row-header">
          <div class="header-player">Seu Her√≥i</div>
          <div class="header-result">Resultado</div>
          <div class="header-heroes">Her√≥is na Partida</div>
          <div class="header-info">Dura√ß√£o & Data</div>
      </div>
      <div *ngFor="let match of matches"
           class="match-row"
           [ngClass]="{ 'win': match.user_won, 'loss': !match.user_won }"
           (click)="viewMatchDetails(match.match_id)">
        <div class="match-player-col">
          <img [src]="gameDataService.getHeroImageUrl(match.user_hero_id)"
               class="hero-icon-medium"
               [alt]="gameDataService.getHeroById(match.user_hero_id)?.localized_name">
          <span class="hero-name">{{ gameDataService.getHeroById(match.user_hero_id)?.localized_name }}</span>
        </div>
        <div class="match-result-col">
          <span class="result-text">{{ match.user_won ? 'Vit√≥ria' : 'Derrota' }}</span>
        </div>
        <div class="match-heroes-col">
          <div class="team-heroes radiant">
            <img *ngFor="let player of match.players | filter:true:'is_radiant'"
                 [src]="gameDataService.getHeroImageUrl(player.hero_id)"
                 class="hero-icon-small"
                 [class.user-hero]="player.hero_id === match.user_hero_id"
                 [alt]="gameDataService.getHeroById(player.hero_id)?.localized_name">
          </div>
          <div class="score-vs">
            <span class="radiant-score">{{ match.radiant_score }}</span>
            <span class="vs-text"> vs </span>
            <span class="dire-score">{{ match.dire_score }}</span>
          </div>
          <div class="team-heroes dire">
            <img *ngFor="let player of match.players | filter:false:'is_radiant'"
                 [src]="gameDataService.getHeroImageUrl(player.hero_id)"
                 class="hero-icon-small"
                 [class.user-hero]="player.hero_id === match.user_hero_id"
                 [alt]="gameDataService.getHeroById(player.hero_id)?.localized_name">
          </div>
        </div>
        <div class="match-info-col">
          <span>{{ (match.duration / 60) | number:'1.0-0' }} min</span>
          <small>{{ match.start_time * 1000 | date:'dd/MM/yy HH:mm' }}</small>
        </div>
      </div>
    </div>
  </ng-template>
</div>

<app-evaluation-form
  *ngIf="isFormVisible"
  [evaluationData]="evaluationInitialData"
  (formClosed)="closeForm()"
  (formSubmitted)="onEvaluationSaved()"
  (evaluationError)="onEvaluationError($event)">
</app-evaluation-form>
